{"version":3,"sources":["../../../src/js/utils/Positioning/getSelectedTextPosition.js"],"names":["getSelectedTextPosition","ZERO_WIDTH_CHARACTER","e","height","target","clientX","clientY","text","width","Math","round","classList","contains","parseInt","window","getComputedStyle","fontSize","left","top","getSelection","selection","rangeCount","range","getRangeAt","cloneRange","rect","getClientRects","rects","length","span","document","createElement","appendChild","createTextNode","insertNode","getBoundingClientRect","spanParent","parentNode","removeChild","normalize"],"mappings":";;;;;kBAawBA,uB;;AAZxB;;;;AACA;;;;;;AAFA;AAIA,IAAMC,uBAAuB,QAA7B;;AAEA;;;;;;;AAOe,SAASD,uBAAT,CAAiCE,CAAjC,EAAoC;AACjD,MAAIC,eAAJ;AADiD,MAEzCC,MAFyC,GAEZF,CAFY,CAEzCE,MAFyC;AAAA,MAEjCC,OAFiC,GAEZH,CAFY,CAEjCG,OAFiC;AAAA,MAExBC,OAFwB,GAEZJ,CAFY,CAExBI,OAFwB;;AAGjD,MAAMC,OAAO,gCAAb;AACA,MAAMC,QAAQC,KAAKC,KAAL,CAAW,4BAAaH,IAAb,EAAmBH,MAAnB,KAA8B,CAAzC,CAAd;AACA,MAAI,CAACG,IAAD,IAASH,OAAOO,SAAP,CAAiBC,QAAjB,CAA0B,eAA1B,CAAb,EAAyD;AACvDT,aAASU,SAASC,OAAOC,gBAAP,CAAwBX,MAAxB,EAAgCY,QAAzC,EAAmD,EAAnD,CAAT;AACA,WAAO;AACLR,kBADK;AAELL,oBAFK;AAGLc,YAAMZ,UAAUG,KAHX;AAILU,WAAKZ;AAJA,KAAP;AAMD;;AAED;AACA,MAAIQ,OAAOK,YAAX,EAAyB;AACvB,QAAMC,YAAYN,OAAOK,YAAP,EAAlB;AACA,QAAIC,UAAUC,UAAd,EAA0B;AACxB,UAAMC,QAAQF,UAAUG,UAAV,CAAqB,CAArB,EAAwBC,UAAxB,EAAd;AACA,UAAIC,OAAO,IAAX;AACA,UAAIH,MAAMI,cAAV,EAA0B;AACxB,YAAMC,QAAQL,MAAMI,cAAN,EAAd;AACA,YAAIC,MAAMC,MAAN,GAAe,CAAnB,EAAsB;AACpBH,iBAAOE,MAAM,CAAN,CAAP;AACD;AACF;;AAED,UAAI,CAACF,IAAL,EAAW;AACT,YAAMI,OAAOC,SAASC,aAAT,CAAuB,MAAvB,CAAb;AACAF,aAAKG,WAAL,CAAiBF,SAASG,cAAT,CAAwBhC,oBAAxB,CAAjB;AACAqB,cAAMY,UAAN,CAAiBL,IAAjB;AACAJ,eAAOI,KAAKM,qBAAL,EAAP;;AAEA,YAAMC,aAAaP,KAAKQ,UAAxB;AACAD,mBAAWE,WAAX,CAAuBT,IAAvB;AACAO,mBAAWG,SAAX;AACD;;AAED,aAAOd,IAAP;AACD;AACF;;AAED,SAAO,IAAP;AACD","file":"getSelectedTextPosition.js","sourcesContent":["/** @module utils/Positoning/getSelectedTextPosition */\r\nimport getSelectedText from '../getSelectedText';\r\nimport getTextWidth from './getTextWidth';\r\n\r\nconst ZERO_WIDTH_CHARACTER = '\\u200b';\r\n\r\n/**\r\n * A utility function to attempt to get the current highlighted text position.\r\n *\r\n * When a context menu is opened, this function attempts to find the bounding client rect\r\n * for the highlighted text. However, if the text is in the text field, some weird stuff\r\n * happens and it is unable to get it correctly.\r\n */\r\nexport default function getSelectedTextPosition(e) {\r\n  let height;\r\n  const { target, clientX, clientY } = e;\r\n  const text = getSelectedText();\r\n  const width = Math.round(getTextWidth(text, target) || 0);\r\n  if (!text || target.classList.contains('md-text-field')) {\r\n    height = parseInt(window.getComputedStyle(target).fontSize, 10);\r\n    return {\r\n      width,\r\n      height,\r\n      left: clientX - width,\r\n      top: clientY,\r\n    };\r\n  }\r\n\r\n  // All browsers I am supporting have window.getSelection, but better safe than sorry\r\n  if (window.getSelection) {\r\n    const selection = window.getSelection();\r\n    if (selection.rangeCount) {\r\n      const range = selection.getRangeAt(0).cloneRange();\r\n      let rect = null;\r\n      if (range.getClientRects) {\r\n        const rects = range.getClientRects();\r\n        if (rects.length > 0) {\r\n          rect = rects[0];\r\n        }\r\n      }\r\n\r\n      if (!rect) {\r\n        const span = document.createElement('span');\r\n        span.appendChild(document.createTextNode(ZERO_WIDTH_CHARACTER));\r\n        range.insertNode(span);\r\n        rect = span.getBoundingClientRect();\r\n\r\n        const spanParent = span.parentNode;\r\n        spanParent.removeChild(span);\r\n        spanParent.normalize();\r\n      }\r\n\r\n      return rect;\r\n    }\r\n  }\r\n\r\n  return null;\r\n}\r\n"]}